{"remainingRequest":"/Users/xingyanan/Desktop/1218toutiao/19toutiao/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/xingyanan/Desktop/1218toutiao/19toutiao/src/views/pubAtricles/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/xingyanan/Desktop/1218toutiao/19toutiao/src/views/pubAtricles/index.vue","mtime":1577539789864},{"path":"/Users/xingyanan/Desktop/1218toutiao/19toutiao/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/xingyanan/Desktop/1218toutiao/19toutiao/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/xingyanan/Desktop/1218toutiao/19toutiao/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/xingyanan/Desktop/1218toutiao/19toutiao/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICAgIGRhdGEoKXsKICAgICAgICByZXR1cm57CiAgICAgICAgICAgIGluZGV4OjEsCiAgICAgICAgICAgIHR5cGVMaXN0OltdLAogICAgICAgICAgICBmb3JtRGF0YTp7CiAgICAgICAgICAgICAgdGl0bGU6JycsCiAgICAgICAgICAgICAgY29udGVudDonJywKICAgICAgICAgICAgICBjb3Zlcjp7CiAgICAgICAgICAgICAgICB0eXBlOi0xLAogICAgICAgICAgICAgICAgaW1hZ2VzOltdLAoKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGNoYW5uZWxfaWQ6bnVsbAogICAgICAgICAgICB9LAogICAgICAgICAgICBydWxlczp7CiAgICAgICAgICAgICAgdGl0bGU6W3tyZXF1aXJlZDp0cnVlLG1lc3NhZ2U6J+agh+mimOS4jeiDveS4uuepuid9LHttaW46NSxtYXg6MzAsbWVzc2FnZTon6ZW/5bqm5ZyoIDUg5YiwIDMwIOS4quWtl+espid9XSwKICAgICAgICAgICAgICBjb250ZW50Olt7cmVxdWlyZWQ6dHJ1ZSxtZXNzYWdlOiflhoXlrrnkuI3og73kuLrnqbonfV0sCiAgICAgICAgICAgICAgY2hhbm5lbF9pZDpbe3JlcXVpcmVkOnRydWUsbWVzc2FnZTon6aKR6YGT5LiN6IO95Li656m6J31dCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAogICAKICAgIG1ldGhvZHM6ewogICAgICAgIGNoYW5nZVBpYygpewogICAgICAgICAgCiAgICAgICAgICAgICAgaWYodGhpcy5mb3JtRGF0YS5jb3Zlci50eXBlPT09MHx8dGhpcy5mb3JtRGF0YS5jb3Zlci50eXBlPT09LTEpewogICAgICAgICAgICAgICAgdGhpcy5mb3JtRGF0YS5jb3Zlci5pbWFnZXM9W10KICAgICAgICAgICAgICB9ZWxzZSBpZih0aGlzLmZvcm1EYXRhLmNvdmVyLnR5cGU9PT0xKXsKICAgICAgICAgICAgICAgIHRoaXMuZm9ybURhdGEuY292ZXIuaW1hZ2VzPVsnJ10KCiAgICAgICAgICAgICAgfWVsc2UgaWYgKHRoaXMuZm9ybURhdGEuY292ZXIudHlwZT09PTMpewogICAgICAgICAgICAgICAgdGhpcy5mb3JtRGF0YS5jb3Zlci5pbWFnZXM9WycnLCcnLCcnXQogICAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFzeW5jIGNoYW5nZVR5cGUoKXsKICAgICAgICAgICBsZXQgcmVzPSBhd2FpdCB0aGlzLiRheGlvcyh7CiAgICAgICAgICAgICAgICB1cmw6Jy9jaGFubmVscycsCgogICAgICAgICAgICB9KQogICAgICAgICAgICB0aGlzLnR5cGVMaXN0PXJlcy5kYXRhLmNoYW5uZWxzCiAgICAgICAgfSwKICAgICAgICBhc3luYyBwdWJBcnRpY2xlKGRyYWZ0KXsKICAgICAgICAgIGF3YWl0IHRoaXMuJHJlZnMucHViUnVsZXMudmFsaWRhdGUoKGlzT2spPT57CiAgICAgICAgICAgIGlmKGlzT2spewogICAgICAgICAgICAgIGxldCB7aWR9PXRoaXMuJHJvdXRlLnBhcmFtcwogICAgICAgICAgICAgIC8v5L+u5pS55LiO5Y+R6KGo5ZCI5YaZCiAgICAgICAgICAgICAgICB0aGlzLiRheGlvcyh7CiAgICAgICAgICAgICAgICAgIG1ldGhvZDppZD8ncHV0JzoncG9zdCcsCiAgICAgICAgICAgICAgICAgIHVybDppZD9gL2FydGljbGVzLyR7aWR9YDonL2FydGljbGVzJywKICAgICAgICAgICAgICAgICAgcGFyYW1zOntkcmFmdH0sIAogICAgICAgICAgICAgICAgICAgZGF0YTp0aGlzLmZvcm1EYXRhCiAgICAgICAgICAgICAgICB9KSAgICAgCiAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCgnL2hvbWUvYXRyaWNsZXMnKSAgICAKICAgICAgICAgICAgfQogICAgICAgICAgfSkKCiAgICAgICAgfSwKICAgICAgICBhc3luYyBnZXRBcnRpY2xlQnlpZChpZCl7CiAgICAgICAgICBsZXQgcmVzPWF3YWl0IHRoaXMuJGF4aW9zKHsKICAgICAgICAgICAgdXJsOmAvYXJ0aWNsZXMvJHtpZH1gLAogICAgICAgICAgICAKICAgICAgICAgIH0pCiAgICAgICAgICB0aGlzLmZvcm1EYXRhPXJlcy5kYXRhCiAgICAgICAgfSwKICAgICAgICBnZXRTb25JbWcoaW1nLGluZGV4KXsKICAgICAgICAgIC8vIGFsZXJ0KCcyMjIyMicraW1nKQogICAgICAgICAgdGhpcy5mb3JtRGF0YS5jb3Zlci5pbWFnZXM9dGhpcy5mb3JtRGF0YS5jb3Zlci5pbWFnZXMubWFwKGZ1bmN0aW9uKGl0bSxpKXsKICAgICAgICAgICAgIGlmKGk9PT1pbmRleCl7CiAgICAgICAgICAgICAgIHJldHVybiBpbWcKICAgICAgICAgICAgIH0KICAgICAgICAgICAgIHJldHVybiBpdG0KICAgICAgICAgIH0pCiAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgCiAgICB9LAogICAgY3JlYXRlZCgpewogICAgICAgIHRoaXMuY2hhbmdlVHlwZSgpOwogICAgICAgbGV0e2lkfSA9IHRoaXMuJHJvdXRlLnBhcmFtczsKICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhpZCkKICAgICAgIGlmKGlkKXsKICAgICAgICAgdGhpcy5nZXRBcnRpY2xlQnlpZChpZCk7CiAgICAgICB9CiAgICB9LAogICAgd2F0Y2g6ewogICAgICAvL+ebkeaOpyRyb3V0ZeS4uuS6huino+WGs+S4pOS4qui3r+eUseS9v+eUqOWQjOS4gOS4que7hOS7tueahOmXrumimAogICAgICAkcm91dGU6ZnVuY3Rpb24odG8pewogICAgICAgIGlmKE9iamVjdC5rZXlzKHRvLnBhcmFtcykubGVuZ3RoKXsKICAgICAgICAgIHRoaXMuJGdldEFydGljbGVCeWlkKHRvLnBhcmFtcy5pZCkKICAgICAgICB9ZWxzZXsKICAgICAgICAgIHRoaXMuZm9ybURhdGE9ewogICAgICAgICAgICAgIHRpdGxlOicnLAogICAgICAgICAgICAgIGNvbnRlbnQ6JycsCiAgICAgICAgICAgICAgY292ZXI6ewogICAgICAgICAgICAgICAgdHlwZTotMSwKICAgICAgICAgICAgICAgIGltYWdlczpbXSwKCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBjaGFubmVsX2lkOm51bGwKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgLy/nm5Hmjqdmb3JtRGF0YS5jb3Zlci50eXBl5Li65LqGCiAgICAgIC8vICJmb3JtRGF0YS5jb3Zlci50eXBlIjpmdW5jdGlvbigpewogICAgICAvLyAgIGlmKHRoaXMuZm9ybURhdGEuY292ZXIudHlwZT09PTB8fHRoaXMuZm9ybURhdGEuY292ZXIudHlwZT09PS0xKXsKICAgICAgLy8gICAgIHRoaXMuZm9ybURhdGEuY292ZXIuaW1hZ2VzPVtdCiAgICAgIC8vICAgfWVsc2UgaWYodGhpcy5mb3JtRGF0YS5jb3Zlci50eXBlPT09MSl7CiAgICAgIC8vICAgICB0aGlzLmZvcm1EYXRhLmNvdmVyLmltYWdlcz1bJyddCgogICAgICAvLyAgIH1lbHNlIGlmICh0aGlzLmZvcm1EYXRhLmNvdmVyLnR5cGU9PT0zKXsKICAgICAgLy8gICAgIHRoaXMuZm9ybURhdGEuY292ZXIuaW1hZ2VzPVsnJywnJywnJ10KICAgICAgLy8gICB9CiAgICAgIC8vIH0KICAgIH0KfTsK"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/pubAtricles","sourcesContent":["<template>\n  <el-card>\n    <bread-crumb slot=\"header\">\n      <template slot=\"title\">内容列表</template>\n    </bread-crumb>\n    <el-form style=\"margin-left:50px\" label-width=\"100px\" :model=\"formData\" :rules=\"rules\" ref=\"pubRules\">\n      <el-form-item label=\"标题\" prop=\"title\">\n        <el-input style=\"width:60%\" v-model=\"formData.title\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"内容\" prop=\"content\">\n        <el-input type=\"textarea\" :rows=\"4\" v-model=\"formData.content\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"封面\" prop=\"type\">\n        <el-radio-group v-model=\"formData.cover.type\" @change=\"changePic\">\n          <el-radio :label=\"1\">单图</el-radio>\n          <el-radio :label=\"3\">三图</el-radio>\n          <el-radio :label=\"0\">无图</el-radio>\n          <el-radio :label=\"-1\">自动</el-radio>\n        </el-radio-group>\n      </el-form-item>\n      <cover-img :list=\"formData.cover.images\" @getSonImg=\"getSonImg\"></cover-img>\n      <el-form-item label=\"频道\" prop=\"channel_id\">\n            <el-select v-model=\"formData.channel_id\">\n                <el-option v-for=\"itm in typeList\" :key=\"itm.id\" :label=\"itm.name\" :value=\"itm.id\"></el-option>\n            </el-select>\n       </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"pubArticle(false)\">发布</el-button>\n        <el-button @click=\"pubArticle(true)\">存入草稿</el-button>\n      </el-form-item>\n    </el-form>\n  </el-card>\n</template>\n\n<script>\nexport default {\n    data(){\n        return{\n            index:1,\n            typeList:[],\n            formData:{\n              title:'',\n              content:'',\n              cover:{\n                type:-1,\n                images:[],\n\n              },\n              channel_id:null\n            },\n            rules:{\n              title:[{required:true,message:'标题不能为空'},{min:5,max:30,message:'长度在 5 到 30 个字符'}],\n              content:[{required:true,message:'内容不能为空'}],\n              channel_id:[{required:true,message:'频道不能为空'}]\n            }\n        }\n    },\n   \n    methods:{\n        changePic(){\n          \n              if(this.formData.cover.type===0||this.formData.cover.type===-1){\n                this.formData.cover.images=[]\n              }else if(this.formData.cover.type===1){\n                this.formData.cover.images=['']\n\n              }else if (this.formData.cover.type===3){\n                this.formData.cover.images=['','','']\n              }\n        },\n        async changeType(){\n           let res= await this.$axios({\n                url:'/channels',\n\n            })\n            this.typeList=res.data.channels\n        },\n        async pubArticle(draft){\n          await this.$refs.pubRules.validate((isOk)=>{\n            if(isOk){\n              let {id}=this.$route.params\n              //修改与发表合写\n                this.$axios({\n                  method:id?'put':'post',\n                  url:id?`/articles/${id}`:'/articles',\n                  params:{draft}, \n                   data:this.formData\n                })     \n                this.$router.push('/home/atricles')    \n            }\n          })\n\n        },\n        async getArticleByid(id){\n          let res=await this.$axios({\n            url:`/articles/${id}`,\n            \n          })\n          this.formData=res.data\n        },\n        getSonImg(img,index){\n          // alert('22222'+img)\n          this.formData.cover.images=this.formData.cover.images.map(function(itm,i){\n             if(i===index){\n               return img\n             }\n             return itm\n          })\n          \n        }\n        \n    },\n    created(){\n        this.changeType();\n       let{id} = this.$route.params;\n       window.console.log(id)\n       if(id){\n         this.getArticleByid(id);\n       }\n    },\n    watch:{\n      //监控$route为了解决两个路由使用同一个组件的问题\n      $route:function(to){\n        if(Object.keys(to.params).length){\n          this.$getArticleByid(to.params.id)\n        }else{\n          this.formData={\n              title:'',\n              content:'',\n              cover:{\n                type:-1,\n                images:[],\n\n              },\n              channel_id:null\n            }\n        }\n      },\n      //监控formData.cover.type为了\n      // \"formData.cover.type\":function(){\n      //   if(this.formData.cover.type===0||this.formData.cover.type===-1){\n      //     this.formData.cover.images=[]\n      //   }else if(this.formData.cover.type===1){\n      //     this.formData.cover.images=['']\n\n      //   }else if (this.formData.cover.type===3){\n      //     this.formData.cover.images=['','','']\n      //   }\n      // }\n    }\n};\n</script>\n\n<style>\n</style>"]}]}